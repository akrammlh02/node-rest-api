<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DevAcademy - Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="icon" type="image/x-icon" href="/images/logo.png">
  <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
</head>

<body>
  <header>
    <nav>
      <img src="/images/logo2-removebg-preview.png" alt="Logo" height="55em">
      <ul class="nav-links">
        <li><a href="/payment/checkout" class="cart-link" title="Checkout">
            <span class="material-symbols-outlined">shopping_cart</span>
            <span class="cart-badge" id="cartBadgeNav" style="display: none;">0</span>
          </a></li>
        <li class="nav-item dropdown account-dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center gap-2 account-pill" href="#" role="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            <div class="user-avatar-small">
              <span class="material-symbols-outlined">person</span>
            </div>
            <div class="user-info-brief">
              <span class="user-name-small">{{fullName}}</span>
              <span class="user-email-small">{{email}}</span>
            </div>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 rounded-4 mt-3">
            <li class="px-3 py-2 border-bottom mb-2">
              <div class="fw-bold text-dark">{{fullName}}</div>
              <div class="text-muted small">{{email}}</div>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2 py-2" onclick="showContent('profile', event)">
                <span class="material-symbols-outlined fs-5">person</span> Profile Settings
              </a>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2 py-2" onclick="showContent('myOrders', event)">
                <span class="material-symbols-outlined fs-5">history</span> Order History
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2 py-2 text-danger" href="/logout">
                <span class="material-symbols-outlined fs-5">logout</span> Logout
              </a>
            </li>
          </ul>
        </li>
      </ul>

      <div class="menu">

        <button class="btn btn-primary menu-button" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"><span
            class="material-symbols-outlined">menu</span></button>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <div class="sidebar-group-label text-muted small fw-bold text-uppercase mb-2" style="letter-spacing: 1px;">
              Learning Area</div>
            <a onclick="showContent('dashboard', event)" class="active"><span
                class="material-symbols-outlined">dashboard</span> Dashboard</a>
            <a onclick="showContent('myCourse', event)"><span class="material-symbols-outlined">book_ribbon</span> My
              Course</a>
            <a onclick="showContent('myCertificate', event)"><span class="material-symbols-outlined">school</span> My
              Certificate</a>
            <a onclick="openInteractive()"><span class="material-symbols-outlined">terminal</span> Interactive
              Lessons</a>
            <a onclick="openQuiz()"><span class="material-symbols-outlined">quiz</span> Programming Quiz</a>

            <div class="sidebar-divider my-3"></div>
            <div class="sidebar-group-label text-muted small fw-bold text-uppercase mb-2" style="letter-spacing: 1px;">
              Account</div>
            <a onclick="showContent('profile', event)"><span class="material-symbols-outlined">person</span> Profile
              Settings</a>
            <a onclick="showContent('myOrders', event)"><span class="material-symbols-outlined">history</span> Order
              History</a>

            <div class="sidebar-divider my-3"></div>
            <div class="sidebar-group-label text-muted small fw-bold text-uppercase mb-2" style="letter-spacing: 1px;">
              Explore</div>
            <a href="/"><span class="material-symbols-outlined">home</span> Home</a>
            <a href="/course"><span class="material-symbols-outlined">book</span> Courses</a>

            <div class="mt-auto pt-4">
              <a href="/logout" class="text-danger fw-bold"><span class="material-symbols-outlined">logout</span>
                Logout</a>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <section class="first-section">
    <aside class="sidebar">
      <div class="sidebar-group">
        <div class="sidebar-group-label">Learning Area</div>
        <ul>
          <li><a onclick="showContent('dashboard', event)" class="active" id="nav-dashboard"><span
                class="material-symbols-outlined">dashboard</span>
              Dashboard</a></li>
          <li><a onclick="showContent('myCourse', event)" id="nav-myCourse"><span
                class="material-symbols-outlined">book_ribbon</span> My
              Course</a></li>
          <li><a onclick="showContent('myCertificate', event)" id="nav-myCertificate"><span
                class="material-symbols-outlined">school</span> My
              Certificate</a></li>
          <li><a onclick="openInteractive()" id="nav-interactive" style="cursor: pointer;"><span
                class="material-symbols-outlined">terminal</span> Interactive Lessons</a></li>
          <li><a onclick="openQuiz()" id="nav-quiz" style="cursor: pointer;"><span
                class="material-symbols-outlined">quiz</span> Programming Quiz</a>
          </li>
        </ul>
      </div>

      <div class="sidebar-group">
        <div class="sidebar-group-label">Account Settings</div>
        <ul>
          <li><a onclick="showContent('profile', event)" id="nav-profile"><span
                class="material-symbols-outlined">person</span>
              Profile</a></li>
          <li><a onclick="showContent('myOrders', event)" id="nav-myOrders"><span
                class="material-symbols-outlined">history</span> My
              Orders</a></li>
        </ul>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-group">
        <div class="sidebar-group-label">Explore</div>
        <ul>
          <li><a href="/"><span class="material-symbols-outlined">home</span> Home</a></li>
          <li><a href="/course"><span class="material-symbols-outlined">book</span> Courses</a></li>
        </ul>
      </div>

      <div class="mt-auto">
        <ul>
          <li><a href="/logout" class="logout-link"><span class="material-symbols-outlined">logout</span>
              Logout</a></li>
        </ul>
      </div>
    </aside>
    <!-- ======== Dashboard section ======== -->
    <section class="dashboard active" id="dashboard">
      <div class="welcome-div">
        <div class="welcome-content">
          <h2>Welcome back, {{fullName}}! ðŸ‘‹</h2>
          <p>Continue your learning journey</p>
        </div>
        <div class="welcome-stats">
          <!-- Membership Status Card -->
          <div
            class="membership-dashboard-card {{#if (eq membershipTier 'VIP')}}vip{{else if (eq membershipTier 'Pro')}}pro{{else}}free{{/if}}">
            <div class="d-flex align-items-center gap-3">
              <div class="tier-icon-circle">
                <span class="material-symbols-outlined">
                  {{#if (eq membershipTier 'VIP')}}workspace_premium{{else if (eq membershipTier
                  'Pro')}}bolt{{else}}person{{/if}}
                </span>
              </div>
              <div>
                <div class="tier-label">{{membershipTier}} Member</div>
                <div class="tier-status">Status: {{membershipStatus}}</div>
              </div>
            </div>
            {{#if membershipExpiry}}
            <div class="expiry-info">
              Expires: {{membershipExpiry}}
            </div>
            {{/if}}
            {{#unless (eq membershipTier 'VIP')}}
            <a href="/interactive/paths#pricing" class="btn-upgrade-lite">Upgrade</a>
            {{/unless}}
          </div>

          <div class="quick-stat">
            <span class="material-symbols-outlined">trending_up</span>
            <div>
              <strong id="enrolledCount">{{enrolledCount}}</strong>
              <span>Enrolled</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Interactive Learning Promo -->
      <div class="interactive-promo-card" onclick="openInteractive()">
        <div class="interactive-promo-content">
          <h3>
            <span class="material-symbols-outlined" style="font-size: 32px;">terminal</span>
            Practice Coding Interactively
          </h3>
          <p>Master your skills with our new hands-on coding challenges. Write code, get instant feedback, and level up!
          </p>
        </div>
        <button class="interactive-promo-btn">Start Practicing</button>
      </div>

      <div class="statistic">
        <div class="stat-card stat-card-primary">
          <div class="stat-icon">
            <span class="material-symbols-outlined">book_ribbon</span>
          </div>
          <div class="stat-content">
            <h1 id="enrolledCountStat">{{enrolledCount}}</h1>
            <p>Enrolled Courses</p>
          </div>
        </div>
        <div class="stat-card stat-card-success">
          <div class="stat-icon">
            <span class="material-symbols-outlined">check_circle</span>
          </div>
          <div class="stat-content">
            <h1 id="completedCount">0</h1>
            <p>Completed Courses</p>
          </div>
        </div>
        <div class="stat-card stat-card-warning">
          <div class="stat-icon">
            <span class="material-symbols-outlined">school</span>
          </div>
          <div class="stat-content">
            <h1 id="certificateCount">0</h1>
            <p>Certificates</p>
          </div>
        </div>
        <div class="stat-card stat-card-info">
          <div class="stat-icon">
            <span class="material-symbols-outlined">schedule</span>
          </div>
          <div class="stat-content">
            <h1 id="learningHours">0</h1>
            <p>Learning Hours</p>
          </div>
        </div>
      </div>

      <div class="courses-section">
        <div class="section-header">
          <h3>My Courses</h3>
          <a href="/course" class="view-all-link">Browse More <span
              class="material-symbols-outlined">arrow_forward</span></a>
        </div>
        <div class="courses-grid" id="recentCoursesContainer">
          {{#if purchasedCourses}}
          {{#each purchasedCourses}}
          <div class="course-card-modern" data-course-id="{{course_id}}">
            <div class="course-image-wrapper">
              <img src="{{thumbnail_url}}" alt="{{title}}" onerror="this.src='/images/front-end-1.jpg'">
              <div class="course-overlay">
                <a href="#" onclick="continueLearning({{course_id}}); return false;" class="btn-overlay">
                  <span class="material-symbols-outlined">play_circle</span>
                </a>
              </div>
            </div>
            <div class="course-card-content">
              <div class="course-header">
                <h4>{{title}}</h4>
                <span class="course-badge">Active</span>
              </div>
              <p class="course-description">{{description}}</p>
              <div class="course-progress-wrapper">
                <div class="progress-info">
                  <span>Progress</span>
                  <span class="progress-percentage" id="progress-{{course_id}}">0%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="progress-bar-{{course_id}}" style="width: 0%"></div>
                </div>
              </div>
              <div class="course-footer">
                <a href="#" onclick="continueLearning({{course_id}}); return false;" class="btn-continue-modern">
                  <span class="material-symbols-outlined">play_arrow</span>
                  Continue Learning
                </a>
              </div>
            </div>
          </div>
          {{/each}}
          {{else}}
          <div class="empty-state-modern">
            <span class="material-symbols-outlined">import_contacts</span>
            <h3>No courses yet</h3>
            <p>Start your learning journey by enrolling in a course</p>
            <a href="/course" class="btn-browse">Browse Courses</a>
          </div>
          {{/if}}
        </div>
      </div>

    </section>


    <!-- ======== My Orders Section ======== -->
    <section class="myOrders" id="myOrders" style="display: none;">
      <div class="page-header mb-4">
        <h1>My Orders & Payments</h1>
        <p>Track the status of your recent course purchases and manual payments</p>
      </div>

      <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="bg-light">
              <tr>
                <th class="ps-4">Date</th>
                <th>Course / Description</th>
                <th>Method</th>
                <th>Amount</th>
                <th>Status</th>
                <th class="pe-4">Information</th>
              </tr>
            </thead>
            <tbody>
              {{#if recentOrders}}
              {{#each recentOrders}}
              <tr>
                <td class="ps-4 small">{{this.created_at}}</td>
                <td>
                  <div class="fw-bold text-dark">
                    {{#if (eq this.payment_type 'membership')}}
                    <span class="badge bg-primary-subtle text-primary border border-primary-subtle px-2 py-1 rounded-3">
                      <span class="material-symbols-rounded align-middle fs-6">workspace_premium</span>
                      {{this.membership_plan}} Membership
                    </span>
                    {{else}}
                    {{this.course_title}}
                    {{/if}}
                  </div>
                  {{#if this.transaction_id}}
                  <div class="text-muted small text-uppercase">TX: {{this.transaction_id}}</div>
                  {{/if}}
                </td>
                <td>
                  <span
                    class="badge rounded-pill bg-light text-dark text-uppercase border">{{this.payment_method}}</span>
                </td>
                <td class="fw-bold text-primary">{{this.amount}} DA</td>
                <td>
                  {{#if (eq this.status 'completed')}}
                  <span class="badge bg-success-subtle text-success border border-success-subtle px-3">Completed</span>
                  {{else if (eq this.status 'pending')}}
                  <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-3">Pending
                    Verification</span>
                  {{else}}
                  <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-3">Failed /
                    Rejected</span>
                  {{/if}}
                </td>
                <td class="pe-4 small text-muted">
                  {{#if (eq this.status 'pending')}}
                  Our team is reviewing your payment proof.
                  {{else if (eq this.status 'completed')}}
                  Payment verified. Access granted!
                  {{else}}
                  Something went wrong. Contact support.
                  {{/if}}
                </td>
              </tr>
              {{/each}}
              {{/if}}
            </tbody>
          </table>
          {{#unless recentOrders}}
          <div class="empty-state-modern py-5">
            <span class="material-symbols-outlined" style="font-size: 64px; opacity: 0.5;">receipt_long</span>
            <h3 class="mt-3">No orders yet</h3>
            <p>Your recent course purchases and payment history will appear here.</p>
            <a href="/course" class="btn-browse">Explore Courses</a>
          </div>
          {{/unless}}
        </div>
      </div>
    </section>

    <!-- ========== My Course section =========== -->
    <section class="myCourse" id="myCourse" style="display: none;">
      <div class="page-header">
        <div>
          <h1>My Courses</h1>
          <p>Track your progress and continue learning</p>
        </div>
        {{!-- <a href="/course" class="btn-browse-courses">
          <span class="material-symbols-outlined">add</span>
          Browse More Courses
        </a> --}}
      </div>
      <div class="courses-grid" id="myCoursesContainer">
        {{#if purchasedCourses}}
        {{#each purchasedCourses}}
        <div class="course-card-modern" data-course-id="{{course_id}}">
          <div class="course-image-wrapper">
            <img src="{{thumbnail_url}}" alt="{{title}}" onerror="this.src='/images/front-end-1.jpg'">
            <div class="course-overlay">
              <a href="#" onclick="continueLearning({{course_id}}); return false;" class="btn-overlay">
                <span class="material-symbols-outlined">play_circle</span>
              </a>
            </div>
          </div>
          <div class="course-card-content">
            <div class="course-header">
              <h4>{{title}}</h4>
              <span class="course-badge">Active</span>
            </div>
            <p class="course-description">{{description}}</p>
            <div class="course-meta-info">
              <span><span class="material-symbols-outlined">alarm</span> {{duration_hours}} hours</span>
              <span><span class="material-symbols-outlined">book_ribbon</span> Lessons</span>
            </div>
            <div class="course-progress-wrapper">
              <div class="progress-info">
                <span>Progress</span>
                <span class="progress-percentage" id="progress-my-{{course_id}}">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="progress-bar-my-{{course_id}}" style="width: 0%"></div>
              </div>
            </div>
            <div class="course-footer">
              <a href="#" onclick="continueLearning({{course_id}}); return false;" class="btn-continue-modern">
                <span class="material-symbols-outlined">play_arrow</span>
                Continue Learning
              </a>
            </div>
          </div>
        </div>
        {{/each}}
        {{else}}
        <div class="empty-state-modern">
          <span class="material-symbols-outlined">import_contacts</span>
          <h3>No courses yet</h3>
          <p>Start your learning journey by enrolling in a course</p>
          <a href="/course" class="btn-browse">Browse Courses</a>
        </div>
        {{/if}}
      </div>
    </section>

    <!-- ======== My Certificate section ========= -->
    <section class="myCertificate" id="myCertificate" style="display: none;">
      <div class="page-header">
        <h1>My Certificates</h1>
        <p>View and download your course completion certificates</p>
      </div>
      <div id="certificatesContainer" class="certificates-grid">
        <!-- Certificates will be loaded here -->
      </div>
    </section>

    <!-- =========  Profile ========= -->
    <section class="profile" id="profile" style="display: none;">
      <h1>Profile</h1>
      <div class="container">
        <div class="information-div">
          <h5>Personal information</h5>
          <form id="profileForm">
            <div class="mb-3">
              <label for="fullNameInput" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="fullNameInput" placeholder="Akram Melihi" value="{{fullName}}"
                required>
            </div>
            <div class="mb-3">
              <label for="emailInput" class="form-label">Email address</label>
              <input type="email" class="form-control" id="emailInput" placeholder="akrammelihi2003@gmail.com"
                value="{{email}}" disabled>
            </div>
            <div id="profileMessage" class="alert" style="display: none;"></div>
            <div>
              <button type="submit" class="btn btn-primary">Save changes</button>
            </div>
          </form>
        </div>
        <div class="password-div">
          <h5>Change Password</h5>
          <form id="passwordForm">
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Current Password</label>
              <div class="password-input-wrapper">
                <input type="password" class="form-control" id="currentPassword" required>
                <span class="toggle-password material-symbols-outlined"
                  onclick="togglePassword('currentPassword')">visibility</span>
              </div>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <div class="password-input-wrapper">
                <input type="password" class="form-control" id="newPassword" required minlength="6">
                <span class="toggle-password material-symbols-outlined"
                  onclick="togglePassword('newPassword')">visibility</span>
              </div>
              <div class="password-strength" id="passwordStrength"></div>
            </div>
            <div class="mb-3">
              <label for="confirmPassword" class="form-label">Confirm Password</label>
              <div class="password-input-wrapper">
                <input type="password" class="form-control" id="confirmPassword" required>
                <span class="toggle-password material-symbols-outlined"
                  onclick="togglePassword('confirmPassword')">visibility</span>
              </div>
              <div id="passwordMatch" class="password-match"></div>
            </div>
            <div id="passwordMessage" class="alert" style="display: none;"></div>
            <div>
              <button type="submit" class="btn btn-primary">Save changes</button>
            </div>
          </form>
        </div>
      </div>
    </section>



  </section>



  <script src="/dashboard.js"></script>
  <script>
    // Check if user is still logged in
    async function checkSession() {
      try {
        const response = await fetch('/api/check-session', {
          method: 'GET',
          credentials: 'include'
        });

        if (!response.ok || response.status === 401) {
          // Session expired or invalid, redirect to login
          window.location.replace('/login');
          return false;
        }
        return true;
      } catch (error) {
        console.error('Session check failed:', error);
        window.location.replace('/login');
        return false;
      }
    }

    // Check session on page load
    window.addEventListener('load', async () => {
      const isValid = await checkSession();
      if (isValid) {
        showContent('dashboard');
        loadDashboardStats();
        loadCourseProgress();
      }
    });

    // Check session when user navigates back (handles back button)
    window.addEventListener('pageshow', async (event) => {
      // If page is loaded from cache (back button), check session
      if (event.persisted) {
        await checkSession();
      }
    });

    // Prevent back button navigation to cached dashboard
    window.addEventListener('popstate', async (event) => {
      await checkSession();
    });

    function showContent(section, event) {
      // Hide all sections
      const sections = document.querySelectorAll('.dashboard, .myCourse, .myCertificate, .profile, .myOrders');
      sections.forEach(sec => sec.style.display = 'none');

      // Show the selected one
      const targetSec = document.getElementById(section);
      if (targetSec) targetSec.style.display = 'block';

      // Load data when section is shown
      if (section === 'myCertificate') {
        loadCertificates();
      } else if (section === 'myCourse') {
        loadMyCourses();
      } else if (section === 'dashboard') {
        loadDashboardStats();
        loadCourseProgress();
      }

      // Handle active class for sidebar and offcanvas
      const allLinks = document.querySelectorAll('.sidebar ul li a, .offcanvas-body a');
      allLinks.forEach(link => link.classList.remove('active'));

      // If called from a click event, mark that element as active
      if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
      } else {
        // Find the matching sidebar link by ID
        const activeLink = document.getElementById(`nav-${section}`);
        if (activeLink) activeLink.classList.add('active');
      }
    }

    // Profile update functionality
    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullName = document.getElementById('fullNameInput').value;
      const messageDiv = document.getElementById('profileMessage');

      try {
        const response = await fetch('/dashboard/api/update-profile', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ fullName })
        });

        const result = await response.json();

        if (result.success) {
          messageDiv.className = 'alert alert-success';
          messageDiv.textContent = result.message || 'Profile updated successfully!';
          messageDiv.style.display = 'block';
          setTimeout(() => {
            messageDiv.style.display = 'none';
            location.reload();
          }, 2000);
        } else {
          messageDiv.className = 'alert alert-danger';
          messageDiv.textContent = result.message || 'Failed to update profile';
          messageDiv.style.display = 'block';
        }
      } catch (error) {
        messageDiv.className = 'alert alert-danger';
        messageDiv.textContent = 'Error updating profile. Please try again.';
        messageDiv.style.display = 'block';
      }
    });

    // Password change functionality
    document.getElementById('passwordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const messageDiv = document.getElementById('passwordMessage');

      // Validation
      if (newPassword !== confirmPassword) {
        messageDiv.className = 'alert alert-danger';
        messageDiv.textContent = 'New passwords do not match!';
        messageDiv.style.display = 'block';
        return;
      }

      if (newPassword.length < 6) {
        messageDiv.className = 'alert alert-danger';
        messageDiv.textContent = 'Password must be at least 6 characters long!';
        messageDiv.style.display = 'block';
        return;
      }

      try {
        const response = await fetch('/dashboard/api/change-password', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });

        const result = await response.json();

        if (result.success) {
          messageDiv.className = 'alert alert-success';
          messageDiv.textContent = result.message || 'Password changed successfully!';
          messageDiv.style.display = 'block';
          document.getElementById('passwordForm').reset();
          setTimeout(() => {
            messageDiv.style.display = 'none';
          }, 3000);
        } else {
          messageDiv.className = 'alert alert-danger';
          messageDiv.textContent = result.message || 'Failed to change password';
          messageDiv.style.display = 'block';
        }
      } catch (error) {
        messageDiv.className = 'alert alert-danger';
        messageDiv.textContent = 'Error changing password. Please try again.';
        messageDiv.style.display = 'block';
      }
    });

    // Password strength indicator
    document.getElementById('newPassword').addEventListener('input', function () {
      const password = this.value;
      const strengthDiv = document.getElementById('passwordStrength');

      if (password.length === 0) {
        strengthDiv.innerHTML = '';
        return;
      }

      let strength = 0;
      let feedback = [];

      if (password.length >= 6) strength++;
      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^A-Za-z0-9]/.test(password)) strength++;

      let strengthText = '';
      let strengthClass = '';

      if (strength <= 2) {
        strengthText = 'Weak';
        strengthClass = 'weak';
      } else if (strength <= 3) {
        strengthText = 'Medium';
        strengthClass = 'medium';
      } else {
        strengthText = 'Strong';
        strengthClass = 'strong';
      }

      strengthDiv.innerHTML = `<div class="strength-indicator ${strengthClass}">Password Strength: <strong>${strengthText}</strong></div>`;
    });

    // Password match indicator
    document.getElementById('confirmPassword').addEventListener('input', function () {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = this.value;
      const matchDiv = document.getElementById('passwordMatch');

      if (confirmPassword.length === 0) {
        matchDiv.innerHTML = '';
        return;
      }

      if (newPassword === confirmPassword) {
        matchDiv.innerHTML = '<span class="text-success">âœ“ Passwords match</span>';
      } else {
        matchDiv.innerHTML = '<span class="text-danger">âœ— Passwords do not match</span>';
      }
    });

    // Toggle password visibility
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const toggle = input.nextElementSibling;

      if (input.type === 'password') {
        input.type = 'text';
        toggle.textContent = 'visibility_off';
      } else {
        input.type = 'password';
        toggle.textContent = 'visibility';
      }
    }

    // Continue learning - redirect to TV page with first lesson
    async function continueLearning(courseId) {
      try {
        const response = await fetch(`/dashboard/api/first-lesson/${courseId}`);
        const result = await response.json();

        if (result.success && result.lessonId) {
          window.location.href = `/course/tv?lessonId=${result.lessonId}`;
        } else {
          alert('No lessons found for this course');
        }
      } catch (error) {
        console.error('Error getting first lesson:', error);
        alert('Error loading course. Please try again.');
      }
    }

    // Animation for Interactive Mode
    function openInteractive() {
      showLoader('Switching mood to coding mode...', '/interactive/paths');
    }

    // Animation for Quiz Mode
    function openQuiz() {
      const loader = document.getElementById('quizLoader');
      if (loader) {
        loader.style.display = 'flex';
        loader.offsetHeight;
        loader.classList.add('active');
        setTimeout(() => {
          window.location.href = '/quiz';
        }, 2500);
      } else {
        window.location.href = '/quiz';
      }
    }

    function showLoader(text, url) {
      const loader = document.getElementById('interactiveLoader');
      const subtext = loader.querySelector('.loader-subtext');

      if (loader) {
        if (subtext) subtext.textContent = text;
        loader.style.display = 'flex';
        loader.offsetHeight; // Force reflow

        requestAnimationFrame(() => {
          loader.classList.add('active');
        });

        setTimeout(() => {
          window.location.href = url;
        }, 2500);
      } else {
        window.location.href = url;
      }
    }
  </script>






  <script src="/js/cart-utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
  <div id="interactiveLoader">
    <div class="loader-content">
      <img src="/images/logo2-removebg-preview.png" alt="DevAcademy" class="loader-logo">
      <div class="loader-text-main">DevAcademy</div>
      <div class="loader-subtext">Switching mood to coding mode...</div>
      <div class="loader-progress-bar"></div>
    </div>
  </div>

  <div id="quizLoader">
    <div class="quiz-loader-content">
      <div class="quiz-spinner"></div>
      <div class="quiz-loader-text">Loading Quiz...</div>
      <div class="quiz-loader-sub">Preparing your knowledge challenge</div>
    </div>
  </div>
</body>

</html>