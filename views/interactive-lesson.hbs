<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Lesson - DevAcademy</title>
    <link rel="stylesheet" href="/interactive-lesson.css">

    <!-- Fonts & Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />

    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-palenight.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Outfit', sans-serif;
        }
    </style>
</head>

<body class="dark-theme">

    <!-- Ambient Backgrounds -->
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>
    <div class="grid-overlay"></div>

    <!-- Global Unified Header -->
    <header class="ide-header">
        <div class="header-left">
            <a href="#" id="backButton" class="btn-back">
                <span class="material-symbols-rounded">arrow_back</span>
                <span class="d-none d-md-inline ms-1">Roadmap</span>
            </a>
            <div class="d-none d-md-block border-start ps-3 ms-3 text-muted">
                <span class="badge bg-white bg-opacity-10 fw-normal"
                    style="font-size: 0.75rem; letter-spacing: 0.5px;">Start Mission</span>
            </div>
        </div>

        <div class="header-center">
            <div class="tab-switcher">
                <div class="file-tab" id="tabText" onclick="switchTab('text')">
                    <span class="material-symbols-rounded icon-file">description</span>
                    <span>Text</span>
                </div>
                <div class="file-tab active" id="tabCode" onclick="switchTab('code')">
                    <span class="material-symbols-rounded icon-file">code</span>
                    <span>Code</span>
                </div>
                <div class="file-tab" id="tabPreview" onclick="switchTab('preview')">
                    <span class="material-symbols-rounded icon-file">visibility</span>
                    <span>Preview</span>
                </div>
            </div>
        </div>

        <div class="header-right">
            <span class="text-muted d-none d-lg-block me-3"
                style="font-size:0.8rem; font-family: 'Fira Code', monospace;" id="attemptsCount"></span>

            <button id="themeToggle" class="btn-icon" title="Toggle Theme" style="display:none;">
                <span class="material-symbols-rounded">dark_mode</span>
            </button>
            <button id="resetCodeBtn" class="btn-icon me-2" title="Reset Code">
                <span class="material-symbols-rounded">restart_alt</span>
            </button>

            <button id="submitCodeBtn" class="btn-run">
                <span class="material-symbols-rounded">play_arrow</span>
                <span>Run</span>
            </button>
        </div>
    </header>

    <div class="ide-wrapper">
        <!-- Left Panel: Instructions -->
        <aside class="panel-left">
            <div class="panel-body custom-scrollbar relative">
                <div id="lessonContent" class="lesson-content">
                    <div class="loading-container">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-3 text-muted">Initialize Mission...</p>
                    </div>
                </div>
            </div>

            <!-- Hints Section (Bottom of Left Panel) -->
            <div id="hintsSection" class="hints-dock" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="label-hints"><span
                            class="material-symbols-rounded fs-5 align-middle me-1">lightbulb</span> Hints</span>
                    <span class="badge-hints" id="hintsCount">0 available</span>
                </div>
                <div id="hintsList" class="hints-container mb-2"></div>
                <button id="showHintBtn" class="btn-reveal-hint">Reveal Hint</button>
            </div>
        </aside>

        <!-- Right Panel: Editor -->
        <main class="panel-right">
            <div class="editor-body">
                <div id="codeWrapper" style="height:100%">
                    <textarea id="codeEditor"></textarea>
                </div>
                <iframe id="livePreview" class="preview-frame" style="display:none;"></iframe>

                <!-- Output Drawer -->
                <div id="outputPanel" class="output-drawer">
                    <div class="drawer-header">
                        <span class="drawer-title"><span
                                class="material-symbols-rounded fs-6 align-middle me-2">terminal</span> Console</span>
                        <button id="clearConsoleBtn" class="btn-close-drawer" title="Clear Console"><span
                                class="material-symbols-rounded">delete_sweep</span></button>
                    </div>
                    <div id="outputContent" class="drawer-content custom-scrollbar"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Feedback Modal Overlay -->
    <div id="feedbackModal" class="modal-overlay feedback-modal" style="display: none;">
        <div class="modal-card-feedback">
            <div class="modal-header-feedback">
                <div class="feedback-modal-icon-wrapper" id="feedbackModalIcon">
                    <span class="material-symbols-rounded feedback-modal-icon" id="feedbackModalIconSymbol">info</span>
                </div>
                <button id="closeFeedbackModal" class="btn-close-modal">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body-feedback">
                <h3 class="feedback-modal-title" id="feedbackModalTitle">AI Analysis</h3>
                <p class="feedback-modal-subtitle" id="feedbackModalSubtitle">Code Review Result</p>
                <div class="feedback-modal-content" id="feedbackModalContent">
                    <!-- Content will be inserted here -->
                </div>
            </div>
            <div class="modal-footer-feedback">
                <div id="feedbackModalErrorActions" style="display: none;">
                    <button id="feedbackModalCloseBtn" class="btn-modal-primary">Got it</button>
                </div>
                <div id="feedbackModalSuccessActions" style="display: none;">
                    <button id="feedbackModalStayBtn" class="btn-modal-ghost">Stay Here</button>
                    <button id="feedbackModalNextBtn" class="btn-modal-primary">Next Mission <span
                            class="material-symbols-rounded align-middle">arrow_forward</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- CodeMirror Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        const lessonId = {{ lessonId }};
    </script>
    <script src="/interactive-lesson.js"></script>
</body>

</html>