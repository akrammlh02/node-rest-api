<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DevAcademy - Admin Panel</title>
  <link rel="stylesheet" href="/admin.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="icon" type="image/x-icon" href="/images/logo.png">
  <style>
    * {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>


<body>
  <header>
    <nav>
      <img src="/images/logo2-removebg-preview.png" alt="Logo" height="55em">
      <ul class="nav-links">
        {{!-- <li><a href="/">Home</a></li> --}}
        {{!-- <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            English
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a></li>
            <li><a class="dropdown-item" href="/">English</a></li>
          </ul>
        </li> --}}
        <li><button type="button" class="btn btn-danger"><a href="/logout"> Logout</a></button></li>

      </ul>
      <div class="menu">

        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight"
          aria-controls="offcanvasRight"><span class="material-symbols-outlined">menu</span></button>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <ul>
              <li><a onclick="afficheSection('Dashboard')">
                  <span class="material-symbols-outlined">dashboard</span> Dashboard</a>
              </li>
              <li><a onclick="afficheSection('Courses')">
                  <span class="material-symbols-outlined">book</span>Courses</a>
              </li>
              <li><a onclick="afficheSection('Clients')">
                  <span class="material-symbols-outlined">group</span>Clients</a>
              </li>
              <li><a onclick="afficheSection('Purchases')">
                  <span class="material-symbols-outlined">local_mall</span>Purchases</a>
              </li>
              <li><a onclick="afficheSection('Certificates')">
                  <span class="material-symbols-outlined">school</span>Certificates</a>
              </li>
              <li><a onclick="afficheSection('Quizzes')">
                  <span class="material-symbols-outlined">quiz</span>Quizzes</a>
              </li>
              <hr>
              <li>
                <div style="width: 50%;">
                  <button type="button" class="btn btn-danger"><a href="/logout"> Logout</a></button>
                </div>
              </li>
            </ul>


            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>


  <main>
    <aside>
      <h2>Menu</h2>
      <ul>
        <li><a onclick="afficheSection('Dashboard')">
            <span class="material-symbols-outlined">dashboard</span> Dashboard</a>
        </li>
        <li><a onclick="afficheSection('Courses')">
            <span class="material-symbols-outlined">book</span>Courses</a>
        </li>
        <li><a onclick="afficheSection('Clients')">
            <span class="material-symbols-outlined">group</span>Clients</a>
        </li>
        <li><a onclick="afficheSection('Purchases')">
            <span class="material-symbols-outlined">local_mall</span>Purchases</a>
        </li>
        <li><a onclick="afficheSection('Certificates')">
            <span class="material-symbols-outlined">school</span>Certificates</a>
        </li>
        <li><a onclick="afficheSection('Quizzes')">
            <span class="material-symbols-outlined">quiz</span>Quizzes</a>
        </li>
        <hr>
        <li><a style="color: red;" href="/logout"><span class="material-symbols-outlined">logout</span>Logout</a>
        </li>
      </ul>
    </aside>


    <section class="right-side">

      <section id="Dashboard" class="dashboard-section">
        <div class="welcome">
          <h1>Welcome, {{fullName}}</h1>
          <p>Here's what's happening on your platform today.</p>
        </div>

        <!-- Main Stats Cards -->
        <div class="cards">
          <div class="card">
            <div class="upside">
              <div class="card-icon" style="background: linear-gradient(135deg, #3b82f6, #06b6d4);">
                <span class="material-symbols-outlined">group</span>
              </div>
              <span class="trend-up material-symbols-outlined">trending_up</span>
            </div>
            <h3 id="totalUsers">0</h3>
            <p>Total Users</p>
          </div>

          <div class="card">
            <div class="upside">
              <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
                <span class="material-symbols-outlined">school</span>
              </div>
              <span class="trend-up material-symbols-outlined">trending_up</span>
            </div>
            <h3 id="totalCourses">0</h3>
            <p>Total Courses</p>
          </div>

          <div class="card">
            <div class="upside">
              <div class="card-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                <span class="material-symbols-outlined">add_shopping_cart</span>
              </div>
              <span class="trend-up material-symbols-outlined">trending_up</span>
            </div>
            <h3 id="totalPurchases">0</h3>
            <p>Total Purchases</p>
          </div>

          <div class="card">
            <div class="upside">
              <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                <span class="material-symbols-outlined">attach_money</span>
              </div>
              <span class="trend-up material-symbols-outlined">trending_up</span>
            </div>
            <h3 id="totalEarnings">0 DA</h3>
            <p>Total Earnings</p>
          </div>
        </div>

        <!-- Profit & Analytics Section -->
        <div style="margin-top: 30px;">
          <h2 style="margin-bottom: 20px; color: #1f2937; font-weight: 600;">
            <span class="material-symbols-outlined" style="vertical-align: middle;">analytics</span>
            Profit & Marketing Analytics
          </h2>

          <!-- Profit Overview Cards -->
          <div class="cards" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="card" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">payments</span>
                </div>
              </div>
              <h3 id="totalRevenue" style="color: white;">0 DA</h3>
              <p style="color: rgba(255,255,255,0.9);">Total Revenue</p>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">campaign</span>
                </div>
              </div>
              <h3 id="totalAdSpend" style="color: white;">0 DA</h3>
              <p style="color: rgba(255,255,255,0.9);">Facebook Ads Spend</p>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #7b09cd, #a855f7); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">trending_up</span>
                </div>
              </div>
              <h3 id="netProfit" style="color: white;">0 DA</h3>
              <p style="color: rgba(255,255,255,0.9);">Net Profit</p>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">percent</span>
                </div>
              </div>
              <h3 id="profitMargin" style="color: white;">0%</h3>
              <p style="color: rgba(255,255,255,0.9);">Profit Margin</p>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #06b6d4, #0891b2); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">calculate</span>
                </div>
              </div>
              <h3 id="roas" style="color: white;">0x</h3>
              <p style="color: rgba(255,255,255,0.9);">ROAS (Return on Ad Spend)</p>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
              <div class="upside">
                <div class="card-icon" style="background: rgba(255,255,255,0.2);">
                  <span class="material-symbols-outlined">shopping_cart</span>
                </div>
              </div>
              <h3 id="avgOrderValue" style="color: white;">0 DA</h3>
              <p style="color: rgba(255,255,255,0.9);">Avg. Order Value</p>
            </div>
          </div>
        </div>

        <!-- Ad Campaign Management & Profit Tracker -->
        <div style="margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <!-- Facebook Ads Manager -->
          <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h3>
                <span class="material-symbols-outlined" style="vertical-align: middle; color: #1877f2;">facebook</span>
                Facebook Ad Campaigns
              </h3>
              <button class="btn btn-primary btn-sm" onclick="openAddAdCampaignModal()"
                style="background-color: #1877f2; border: none;">
                <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 18px;">add</span>
                Add Campaign
              </button>
            </div>
            <table class="table table-sm table-hover">
              <thead>
                <tr>
                  <th>Campaign</th>
                  <th>Spend</th>
                  <th>Period</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="adCampaignsTableBody">
                <tr>
                  <td colspan="4" class="text-center text-muted">No campaigns yet. Add one to track your ad spend.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Quick Profit Calculator -->
          <div class="table-container">
            <h3 style="margin-bottom: 15px;">
              <span class="material-symbols-outlined" style="vertical-align: middle; color: #10b981;">calculate</span>
              Quick Profit Calculator
            </h3>
            <div style="background: #f9fafb; padding: 20px; border-radius: 8px;">
              <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; color: #374151; display: block; margin-bottom: 5px;">
                  <span class="material-symbols-outlined"
                    style="vertical-align: middle; font-size: 18px;">payments</span>
                  Total Revenue
                </label>
                <input type="number" id="calcRevenue" class="form-control" placeholder="0" readonly
                  style="background: white; font-weight: 600; font-size: 18px; color: #10b981;">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="font-weight: 600; color: #374151; display: block; margin-bottom: 5px;">
                  <span class="material-symbols-outlined"
                    style="vertical-align: middle; font-size: 18px;">campaign</span>
                  Total Ad Spend
                </label>
                <input type="number" id="calcAdSpend" class="form-control" placeholder="0" readonly
                  style="background: white; font-weight: 600; font-size: 18px; color: #ef4444;">
              </div>
              <hr style="margin: 20px 0;">
              <div
                style="background: linear-gradient(135deg, #7b09cd, #a855f7); padding: 15px; border-radius: 8px; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="font-weight: 600; font-size: 16px;">
                    <span class="material-symbols-outlined" style="vertical-align: middle;">trending_up</span>
                    Net Profit
                  </span>
                  <span id="calcProfit" style="font-weight: 700; font-size: 24px;">0 DA</span>
                </div>
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                  <small>Profit Margin: <strong id="calcMargin">0%</strong></small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Monthly Performance Chart -->
        <div style="margin-top: 30px;">
          <div class="table-container">
            <h3 style="margin-bottom: 15px;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">show_chart</span>
              Monthly Performance Overview
            </h3>
            <div style="overflow-x: auto;">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Month</th>
                    <th>Revenue</th>
                    <th>Ad Spend</th>
                    <th>Profit</th>
                    <th>Margin</th>
                    <th>ROAS</th>
                    <th>Sales</th>
                  </tr>
                </thead>
                <tbody id="monthlyPerformanceBody">
                  <tr>
                    <td colspan="7" class="text-center text-muted">Loading monthly data...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </section>

      <section id="Courses" class="courses-section" style="display: none;">
        <div class="welcome">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1>Welcome to Courses section</h1>
              <p>Where you can manage your courses, chapters, and lessons.</p>
            </div>
            <button class="btn btn-primary" onclick="openAddCourseModal()"
              style="background-color: #7b09cd; border: none;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">add</span> Add Course
            </button>
          </div>
        </div>

        <div class="table-container">
          <h3>Courses</h3>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Price</th>
                <th>Status</th>
                <th>Access Type</th>
                <th>Chapters</th>
                <th>Total Lessons</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="coursesTableBody">
              {{#each courses}}
              <tr>
                <td>
                  <strong>{{title}}</strong>
                </td>
                <td>
                  {{#if level}}
                  <span class="badge badge-info">{{level}}</span>
                  {{else}}
                  <span class="text-muted">-</span>
                  {{/if}}
                </td>
                <td>{{price}} DA</td>
                <td>
                  {{#if is_published}}
                  <span class="badge badge-success">Published</span>
                  {{else}}
                  <span class="badge badge-warning">Draft</span>
                  {{/if}}
                </td>
                <td>
                  <button class="btn btn-sm {{#if is_free}}btn-success{{else}}btn-warning{{/if}}"
                    onclick="toggleCourseFree({{course_id}}, {{#if is_free}}1{{else}}0{{/if}})"
                    title="Click to toggle Free/Paid access" style="min-width: 70px;">
                    {{#if is_free}}ðŸ†“ FREE{{else}}ðŸ’° PAID{{/if}}
                  </button>
                </td>
                <td class="chapter-count-{{course_id}}">0</td>
                <td class="lesson-count-{{course_id}}">0</td>
                <td>
                  <button class="btn btn-sm btn-primary" onclick="manageCourse({{course_id}})" title="Manage Chapters">
                    <span class="material-symbols-outlined">settings</span> Manage
                  </button>
                  <button class="btn btn-sm btn-info" onclick="editCourse({{course_id}})" title="Edit Course">
                    <span class="material-symbols-outlined">edit</span> Edit
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteCourse({{course_id}})" title="Delete">
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Add Course Modal -->
      <div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="addCourseForm">
                <input type="hidden" id="editCourseId" value="">
                <div class="mb-3">
                  <label for="courseTitle" class="form-label">Course Title <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="courseTitle" required>
                </div>

                <div class="mb-3">
                  <label for="courseDescription" class="form-label">Description <span
                      class="text-danger">*</span></label>
                  <textarea class="form-control" id="courseDescription" rows="3" required></textarea>
                </div>

                <div class="mb-3">
                  <label for="courseImage" class="form-label">Course Image <span class="text-danger">*</span></label>
                  <input type="file" class="form-control" id="courseImage" accept="image/*" required>
                  <small class="form-text text-muted">Upload an image for the course (Max 5MB)</small>
                  <div id="imagePreview" style="margin-top: 10px; display: none;">
                    <img id="previewImg" src="" alt="Preview"
                      style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #7b09cd;">
                  </div>
                  <input type="hidden" id="existingImageUrl" value="">
                </div>

                <div class="mb-3">
                  <label for="coursePrice" class="form-label">Price <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" id="coursePrice" step="0.01" min="0" required>
                </div>
                <div class="mb-3">
                  <label for="durationHours" class="form-label">Duration time : (Hours) <span
                      class="text-danger">*</span></label>
                  <input type="number" class="form-control" id="durationHours" required>
                </div>
                <div class="mb-3">
                  <label for="courseCategory" class="form-label">Category <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="courseCategory"
                    placeholder="e.g., Web Development, AI, Python" required>
                </div>
                <div class="mb-3">
                  <label for="previewVideoUrl" class="form-label">Preview Video URL</label>
                  <input type="url" class="form-control" id="previewVideoUrl"
                    placeholder="https://www.youtube.com/embed/VIDEO_ID">
                  <small class="form-text text-muted">
                    <strong>Important:</strong> Use YouTube embed format:
                    <code>https://www.youtube.com/embed/VIDEO_ID</code>
                    <br>
                    Example: If your video is <code>youtu.be/ABC123</code>, use
                    <code>https://www.youtube.com/embed/ABC123</code>
                  </small>
                </div>
                <div class="mb-3">
                  <label for="courseSkills" class="form-label">Skills (Comma separated)</label>
                  <input type="text" class="form-control" id="courseSkills"
                    placeholder="e.g., HTML, CSS, JavaScript, React">
                  <small class="form-text text-muted">These will be displayed on the course card instead of the
                    description.</small>
                </div>
                <div class="mb-3">
                  <label for="isPublished" class="form-label">Status <span class="text-danger">*</span></label>
                  <select type="select" class="form-control" id="isPublished" required>
                    <option value="draft">Draft</option>
                    <option value="publish">Publish</option>
                  </select>
                </div>

                <div class="mb-3" id="messageCourse" style="display: none;">
                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">Save
                    Course</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Manage Course Modal (Chapters) -->
      <div class="modal fade" id="manageCourseModal" tabindex="-1" aria-labelledby="manageCourseModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="manageCourseModalLabel">Manage Course: <span id="manageCourseTitle"></span>
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="quick-add-section">
                <h6>Quick Add Chapter</h6>
                <div class="input-group mb-3">
                  <input type="text" class="form-control" id="quickChapterTitle" placeholder="Chapter Title"
                    onkeypress="if(event.key === 'Enter') quickAddChapter()">
                  <button class="btn btn-primary" onclick="quickAddChapter()"
                    style="background-color: #7b09cd; border: none;">
                    <span class="material-symbols-outlined">add</span> Add
                  </button>
                </div>
              </div>
              <hr>
              <h6>Chapters</h6>
              <table class="table table-sm table-bordered">
                <thead>
                  <tr>
                    <th style="width: 50px;">Order</th>
                    <th>Title</th>
                    <th style="width: 100px;">Status</th>
                    <th>Lessons</th>
                    <th style="width: 300px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="chaptersTableBody">
                  <!-- Chapters will be dynamically added here -->
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Manage Chapter Modal (Lessons) -->
      <div class="modal fade" id="manageChapterModal" tabindex="-1" aria-labelledby="manageChapterModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="manageChapterModalLabel">Manage Chapter: <span id="manageChapterTitle"></span>
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="quick-add-section">
                <h6>Quick Add Lesson</h6>
                <div class="mb-3">
                  <input type="text" class="form-control mb-2" id="quickLessonTitle" placeholder="Lesson Title"
                    onkeypress="if(event.key === 'Enter') document.getElementById('quickLessonVideoUrl').focus()">
                  <input type="url" class="form-control mb-2" id="quickLessonVideoUrl" placeholder="Video URL"
                    onkeypress="if(event.key === 'Enter') document.getElementById('quickLessonResources').focus()">
                  <textarea class="form-control mb-2" id="quickLessonResources" rows="2"
                    placeholder="Resources (optional): One URL per line"
                    onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); quickAddLesson(); }"></textarea>
                  <button class="btn btn-primary w-100" onclick="quickAddLesson()"
                    style="background-color: #7b09cd; border: none;">
                    <span class="material-symbols-outlined" style="vertical-align: middle;">add</span> Add Lesson
                  </button>
                </div>
              </div>
              <hr>
              <h6>Lessons</h6>
              <table class="table table-sm table-bordered">
                <thead>
                  <tr>
                    <th style="width: 50px;">Order</th>
                    <th>Title</th>
                    <th style="width: 100px;">Status</th>
                    <th>Video URL</th>
                    <th style="width: 300px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="lessonsTableBody">
                  <!-- Lessons will be dynamically added here -->
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Chapter Modal -->
      <div class="modal fade" id="editChapterModal" tabindex="-1" aria-labelledby="editChapterModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editChapterModalLabel">Edit Chapter</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editChapterForm">
              <div class="modal-body">
                <input type="hidden" id="editChapterId" value="">
                <div class="mb-3">
                  <label for="editChapterTitle" class="form-label">Chapter Title <span
                      class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="editChapterTitle" required>
                </div>
                <div id="editChapterMessage" class="alert" style="display: none;"></div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">Save
                  Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Edit Lesson Modal -->
      <div class="modal fade" id="editLessonModal" tabindex="-1" aria-labelledby="editLessonModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editLessonModalLabel">Edit Lesson</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editLessonForm">
              <div class="modal-body">
                <input type="hidden" id="editLessonId" value="">
                <div class="mb-3">
                  <label for="editLessonTitle" class="form-label">Lesson Title <span
                      class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="editLessonTitle" required>
                </div>
                <div class="mb-3">
                  <label for="editLessonVideoUrl" class="form-label">Video URL <span
                      class="text-danger">*</span></label>
                  <input type="url" class="form-control" id="editLessonVideoUrl" required
                    placeholder="https://example.com/video.mp4">
                  <small class="form-text text-muted">Enter the full URL to the video</small>
                </div>
                <div class="mb-3">
                  <label for="editLessonResources" class="form-label">
                    <span class="material-symbols-outlined"
                      style="vertical-align: middle; font-size: 18px;">folder_open</span>
                    Downloadable Resources (Optional)
                  </label>
                  <textarea class="form-control" id="editLessonResources" rows="3"
                    placeholder="Add resource links (one per line)&#10;Example:&#10;https://example.com/notes.pdf&#10;https://example.com/exercises.zip"></textarea>
                  <small class="form-text text-muted">
                    Add downloadable resources like PDFs, ZIP files, or links. One URL per line.
                    Students will be able to download these materials.
                  </small>
                </div>
                <div id="editLessonMessage" class="alert" style="display: none;"></div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">Save
                  Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>


      <section id="Clients" class="clients-section" style="display: none;">
        <div class="welcome">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div>
              <h1>Clients Management</h1>
              <p>Manage all your registered users and track their progress.</p>
            </div>
            <button class="btn btn-success" onclick="exportClients()" style="background-color: #10b981; border: none;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">download</span>
              Export Clients
            </button>
          </div>
        </div>

        <!-- Client Statistics -->
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #06b6d4);">
              <span class="material-symbols-outlined">group</span>
            </div>
            <div class="stat-info">
              <h4 id="totalClientsCount">0</h4>
              <p>Total Clients</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
              <span class="material-symbols-outlined">shopping_bag</span>
            </div>
            <div class="stat-info">
              <h4 id="payingClientsCount">0</h4>
              <p>Paying Customers</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
              <span class="material-symbols-outlined">person_add</span>
            </div>
            <div class="stat-info">
              <h4 id="freeClientsCount">0</h4>
              <p>Free Users</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
              <span class="material-symbols-outlined">trending_up</span>
            </div>
            <div class="stat-info">
              <h4 id="activeClientsCount">0</h4>
              <p>Active Learners</p>
            </div>
          </div>
        </div>

        <div class="table-container">
          <div class="section-header">
            <h3>All Clients</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; flex: 1; justify-content: flex-end;">
              <div class="search-box">
                <input type="text" class="form-control" id="clientSearch" placeholder="Search clients..."
                  onkeyup="filterClients()">
                <span class="material-symbols-outlined search-icon">search</span>
              </div>
              <div class="filter-buttons">
                <button class="btn btn-filter active" onclick="filterClientsByType('all')">All</button>
                <button class="btn btn-filter" onclick="filterClientsByType('paying')">Paying</button>
                <button class="btn btn-filter" onclick="filterClientsByType('free')">Free</button>
                <button class="btn btn-filter" onclick="filterClientsByType('active')">Active</button>
              </div>
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Type</th>
                  <th>Courses</th>
                  <th>Progress</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="clientsTableBody">
                <!-- Clients will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Client Details Modal -->
      <div class="modal fade" id="clientDetailsModal" tabindex="-1" aria-labelledby="clientDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="clientDetailsModalLabel">
                <span class="material-symbols-outlined" style="vertical-align: middle;">person</span>
                Client Details
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="clientDetailsContent">
                <!-- Client details will be loaded here -->
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Course to Client Modal -->
      <div class="modal fade" id="addCourseToClientModal" tabindex="-1" aria-labelledby="addCourseToClientModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addCourseToClientModalLabel">Add Course to Client</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="addCourseToClientForm">
                <input type="hidden" id="selectedClientId" value="">
                <div class="mb-3">
                  <label for="clientCourseSelect" class="form-label">Select Course <span
                      class="text-danger">*</span></label>
                  <select class="form-control" id="clientCourseSelect" required>
                    <option value="">-- Select Course --</option>
                  </select>
                </div>
                <div class="mb-3" id="messageClientCourse" style="display: none;">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">Add
                    Course</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Remove Course from Client Modal -->
      <div class="modal fade" id="removeCourseFromClientModal" tabindex="-1"
        aria-labelledby="removeCourseFromClientModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="removeCourseFromClientModalLabel">Remove Course from Client</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="removeCourseFromClientForm">
                <input type="hidden" id="selectedClientIdRemove" value="">
                <div class="mb-3">
                  <label for="clientCourseSelectRemove" class="form-label">Select Course to Remove <span
                      class="text-danger">*</span></label>
                  <select class="form-control" id="clientCourseSelectRemove" required>
                    <option value="">-- Select Course --</option>
                  </select>
                </div>
                <div class="mb-3" id="messageClientCourseRemove" style="display: none;">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-danger">Remove Course</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <section id="Purchases" class="purchases-section" style="display: none;">
        <div class="welcome">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div>
              <h1>Purchases Management</h1>
              <p>View and manage all course purchases and transactions.</p>
            </div>
            <button class="btn btn-success" onclick="exportPurchases()"
              style="background-color: #10b981; border: none;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">download</span>
              Export to Excel
            </button>
          </div>
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon">
              <span class="material-symbols-outlined">shopping_cart</span>
            </div>
            <div class="stat-info">
              <h4 id="totalPurchasesCount">0</h4>
              <p>Total Purchases</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
              <span class="material-symbols-outlined">attach_money</span>
            </div>
            <div class="stat-info">
              <h4 id="totalRevenueAmount">0 DA</h4>
              <p>Total Revenue</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
              <span class="material-symbols-outlined">today</span>
            </div>
            <div class="stat-info">
              <h4 id="todayPurchasesCount">0</h4>
              <p>Today's Purchases</p>
            </div>
          </div>
        </div>

        <div class="table-container">
          <div class="section-header">
            <h3>All Purchases</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; flex: 1; justify-content: flex-end;">
              <div class="search-box">
                <input type="text" class="form-control" id="purchaseSearch" placeholder="Search purchases..."
                  onkeyup="searchPurchases()">
                <span class="material-symbols-outlined search-icon">search</span>
              </div>
              <div class="filter-buttons">
                <button class="btn btn-filter active" onclick="filterPurchases('all')">All</button>
                <button class="btn btn-filter" onclick="filterPurchases('today')">Today</button>
                <button class="btn btn-filter" onclick="filterPurchases('week')">This Week</button>
                <button class="btn btn-filter" onclick="filterPurchases('month')">This Month</button>
              </div>
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Purchase ID</th>
                  <th>Client Name</th>
                  <th>Course</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="purchasesTableBody">
                <!-- Purchases will be dynamically added here -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Purchase Details Modal -->
      <div class="modal fade" id="purchaseDetailsModal" tabindex="-1" aria-labelledby="purchaseDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="purchaseDetailsModalLabel">
                <span class="material-symbols-outlined" style="vertical-align: middle;">receipt_long</span>
                Purchase Details
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="purchaseDetailsContent">
                <!-- Purchase details will be loaded here -->
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>


      <section id="Certificates" class="certificates-section" style="display: none;">
        <div class="welcome">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1>Certificates Management</h1>
              <p>View and manage all issued certificates.</p>
            </div>
            <button class="btn btn-primary" onclick="openIssueCertificateModal()"
              style="background-color: #7b09cd; border: none;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">add</span> Issue Certificate
            </button>
          </div>
        </div>

        <div class="table-container">
          <h3>All Certificates</h3>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Certificate ID</th>
                <th>Client Name</th>
                <th>Course</th>
                <th>Category</th>
                <th>Date Issued</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="certificatesTableBody">
              <!-- Certificates will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Issue Certificate Modal -->
      <div class="modal fade" id="issueCertificateModal" tabindex="-1" aria-labelledby="issueCertificateModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="issueCertificateModalLabel">Issue Certificate</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="issueCertificateForm">
                <div class="mb-3">
                  <label for="certificateClientSelect" class="form-label">Select Client <span
                      class="text-danger">*</span></label>
                  <select class="form-control" id="certificateClientSelect" required>
                    <option value="">-- Select Client --</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="certificateCourseSelect" class="form-label">Select Course <span
                      class="text-danger">*</span></label>
                  <select class="form-control" id="certificateCourseSelect" required>
                    <option value="">-- Select Course --</option>
                  </select>
                </div>
                <div class="mb-3" id="messageCertificate" style="display: none;">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">Issue
                    Certificate</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Quizzes Section -->
      <section id="Quizzes" class="quizzes-section" style="display: none;">
        <div class="welcome">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h1>Quiz Management</h1>
              <p>Manage programming quiz questions and languages.</p>
            </div>
            <button class="btn btn-primary" onclick="openAddQuizModal()"
              style="background-color: #7b09cd; border: none;">
              <span class="material-symbols-outlined" style="vertical-align: middle;">add</span> Add Question
            </button>
          </div>
        </div>

        <div class="table-container">
          <div class="section-header">
            <h3>Quiz Questions</h3>
            <div class="filter-buttons">
              <select class="form-select" id="languageFilter" onchange="filterQuizzesByLanguage()"
                style="width: auto; display: inline-block;">
                <option value="">All Languages</option>
              </select>
            </div>
          </div>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Language</th>
                <th>Question</th>
                <th>Correct Answer</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="quizzesTableBody">
              <!-- Quiz questions will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Add Quiz Modal - Improved UI -->
      <div class="modal fade" id="addQuizModal" tabindex="-1" aria-labelledby="addQuizModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #7b09cd, #a855f7); color: white;">
              <h5 class="modal-title" id="addQuizModalLabel">
                <span class="material-symbols-outlined" style="vertical-align: middle;">quiz</span>
                Add Quiz Questions
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Tab Navigation -->
              <ul class="nav nav-tabs mb-4" id="quizTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single-question"
                    type="button">
                    <span class="material-symbols-outlined"
                      style="vertical-align: middle; font-size: 18px;">edit_note</span>
                    Single Question
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="bulk-tab" data-bs-toggle="tab" data-bs-target="#bulk-import"
                    type="button">
                    <span class="material-symbols-outlined"
                      style="vertical-align: middle; font-size: 18px;">upload_file</span>
                    Bulk Import
                  </button>
                </li>
              </ul>

              <!-- Tab Content -->
              <div class="tab-content" id="quizTabContent">
                <!-- Single Question Tab -->
                <div class="tab-pane fade show active" id="single-question" role="tabpanel">
                  <form id="addQuizForm">
                    <input type="hidden" id="editQuizId" value="">

                    <div class="row">
                      <div class="col-md-12">
                        <div class="mb-3">
                          <label for="programmingLanguage" class="form-label">
                            <strong>Programming Language</strong> <span class="text-danger">*</span>
                          </label>
                          <select class="form-control form-select" id="programmingLanguage" required>
                            <option value="">-- Select Language --</option>
                            <option value="JavaScript">JavaScript</option>
                            <option value="Python">Python</option>
                            <option value="Java">Java</option>
                            <option value="C++">C++</option>
                            <option value="C#">C#</option>
                            <option value="PHP">PHP</option>
                            <option value="Ruby">Ruby</option>
                            <option value="Go">Go</option>
                            <option value="Rust">Rust</option>
                            <option value="Swift">Swift</option>
                            <option value="Kotlin">Kotlin</option>
                            <option value="TypeScript">TypeScript</option>
                            <option value="SQL">SQL</option>
                            <option value="HTML/CSS">HTML/CSS</option>
                            <option value="Other">Other</option>
                          </select>
                          <small class="text-muted">Select the programming language this question is about</small>
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="quizQuestion" class="form-label">
                        <strong>Question</strong> <span class="text-danger">*</span>
                      </label>
                      <textarea class="form-control" id="quizQuestion" rows="4" required
                        placeholder="Enter your quiz question here..."></textarea>
                      <small class="text-muted">Tip: Be clear and concise</small>
                    </div>

                    <div class="card mb-3" style="border: 2px dashed #dee2e6;">
                      <div class="card-header" style="background-color: #f8f9fa;">
                        <strong>Answer Options</strong>
                      </div>
                      <div class="card-body">
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label for="optionA" class="form-label">
                              <span class="badge bg-primary">A</span> Option A <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="optionA" required placeholder="First option">
                          </div>
                          <div class="col-md-6">
                            <label for="optionB" class="form-label">
                              <span class="badge bg-primary">B</span> Option B <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="optionB" required placeholder="Second option">
                          </div>
                          <div class="col-md-6">
                            <label for="optionC" class="form-label">
                              <span class="badge bg-primary">C</span> Option C <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="optionC" required placeholder="Third option">
                          </div>
                          <div class="col-md-6">
                            <label for="optionD" class="form-label">
                              <span class="badge bg-primary">D</span> Option D <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="optionD" required placeholder="Fourth option">
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="correctOption" class="form-label">
                        <strong>Correct Answer</strong> <span class="text-danger">*</span>
                      </label>
                      <div class="btn-group w-100" role="group" id="correctOptionGroup">
                        <input type="radio" class="btn-check" name="correctOption" id="correctA" value="A">
                        <label class="btn btn-outline-success" for="correctA">A</label>

                        <input type="radio" class="btn-check" name="correctOption" id="correctB" value="B">
                        <label class="btn btn-outline-success" for="correctB">B</label>

                        <input type="radio" class="btn-check" name="correctOption" id="correctC" value="C">
                        <label class="btn btn-outline-success" for="correctC">C</label>

                        <input type="radio" class="btn-check" name="correctOption" id="correctD" value="D">
                        <label class="btn btn-outline-success" for="correctD">D</label>
                      </div>
                      <small class="text-muted">Click the letter of the correct answer</small>
                    </div>

                    <div class="mb-3" id="messageQuiz" style="display: none;"></div>

                    <div class="modal-footer" style="border-top: 2px solid #dee2e6; padding-top: 20px;">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-outline-primary" id="saveAndAddAnother">
                        <span class="material-symbols-outlined"
                          style="vertical-align: middle; font-size: 18px;">add</span>
                        Save & Add Another
                      </button>
                      <button type="submit" class="btn btn-primary" style="background-color: #7b09cd; border: none;">
                        <span class="material-symbols-outlined"
                          style="vertical-align: middle; font-size: 18px;">save</span>
                        Save Question
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Bulk Import Tab -->
                <div class="tab-pane fade" id="bulk-import" role="tabpanel">
                  <div class="alert alert-info">
                    <strong>Import Multiple Questions at Once!</strong>
                    <p class="mb-0">Upload a JSON file with multiple quiz questions. This is much faster than adding
                      questions one by one.</p>
                  </div>

                  <div class="card mb-3">
                    <div class="card-header" style="background-color: #f8f9fa;">
                      <strong>JSON Format Example</strong>
                    </div>
                    <div class="card-body">
                      <pre
                        style="background-color: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>[
  {
    "language": "JavaScript",
    "question": "What is the output of: console.log(typeof [])?",
    "option_a": "array",
    "option_b": "object",
    "option_c": "undefined",
    "option_d": "null",
    "correct_option": "B"
  },
  {
    "language": "Python",
    "question": "Which keyword is used to define a function in Python?",
    "option_a": "function",
    "option_b": "def",
    "option_c": "func",
    "option_d": "define",
    "correct_option": "B"
  }
]</code></pre>
                      <button class="btn btn-sm btn-outline-secondary mt-2" onclick="downloadQuizTemplate()">
                        <span class="material-symbols-outlined"
                          style="vertical-align: middle; font-size: 18px;">download</span>
                        Download Template
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="bulkQuizFile" class="form-label"><strong>Upload JSON File</strong></label>
                    <input type="file" class="form-control" id="bulkQuizFile" accept=".json">
                  </div>

                  <div id="bulkPreview" class="mb-3" style="display: none;">
                    <h6>Preview:</h6>
                    <div id="bulkPreviewContent" class="alert alert-secondary"
                      style="max-height: 300px; overflow-y: auto;"></div>
                  </div>

                  <div class="mb-3" id="messageBulk" style="display: none;"></div>

                  <div class="modal-footer" style="border-top: 2px solid #dee2e6; padding-top: 20px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="importBulkQuizzes"
                      style="background-color: #7b09cd; border: none;" disabled>
                      <span class="material-symbols-outlined"
                        style="vertical-align: middle; font-size: 18px;">cloud_upload</span>
                      Import Questions
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Ad Campaign Modal -->
      <div class="modal fade" id="addAdCampaignModal" tabindex="-1" aria-labelledby="addAdCampaignModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1877f2, #0c63e4); color: white;">
              <h5 class="modal-title" id="addAdCampaignModalLabel">
                <span class="material-symbols-outlined" style="vertical-align: middle;">campaign</span>
                Add Facebook Ad Campaign
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="addAdCampaignForm">
                <input type="hidden" id="editCampaignId" value="">

                <div class="mb-3">
                  <label for="campaignName" class="form-label">
                    <strong>Campaign Name</strong> <span class="text-danger">*</span>
                  </label>
                  <input type="text" class="form-control" id="campaignName" required
                    placeholder="e.g., Black Friday Sale 2024">
                  <small class="text-muted">Give your campaign a memorable name</small>
                </div>

                <div class="mb-3">
                  <label for="campaignSpend" class="form-label">
                    <strong>Ad Spend Amount (DA)</strong> <span class="text-danger">*</span>
                  </label>
                  <input type="number" class="form-control" id="campaignSpend" required min="0" step="0.01"
                    placeholder="0.00">
                  <small class="text-muted">Total amount spent on this campaign</small>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="campaignStartDate" class="form-label">
                        <strong>Start Date</strong> <span class="text-danger">*</span>
                      </label>
                      <input type="date" class="form-control" id="campaignStartDate" required>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="campaignEndDate" class="form-label">
                        <strong>End Date</strong>
                      </label>
                      <input type="date" class="form-control" id="campaignEndDate">
                      <small class="text-muted">Leave empty if ongoing</small>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="campaignNotes" class="form-label">
                    <strong>Notes</strong>
                  </label>
                  <textarea class="form-control" id="campaignNotes" rows="3"
                    placeholder="Add any notes about this campaign..."></textarea>
                </div>

                <div class="mb-3" id="messageAdCampaign" style="display: none;"></div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary" style="background-color: #1877f2; border: none;">
                    <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 18px;">save</span>
                    Save Campaign
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <script src="/admin.js"></script>
  <script src="/admin-edit-modals.js"></script>
  <script src="/admin-profit.js"></script>
  <script>
    function afficheSection(sectionId) {
      const sections = document.querySelectorAll('.dashboard-section, .courses-section, .clients-section, .purchases-section, .certificates-section, .quizzes-section');
      sections.forEach(sec => sec.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';

      // Load data when section is shown
      if (sectionId === 'Clients') {
        loadClients();
      } else if (sectionId === 'Purchases') {
        loadPurchases();
      } else if (sectionId === 'Certificates') {
        loadCertificates();
      } else if (sectionId === 'Quizzes') {
        loadQuizzes();
      } else if (sectionId === 'Dashboard') {
        loadDashboardStats();
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function () {
      // Load course stats
      loadCourseStats();
      // Load dashboard stats
      loadDashboardStats();

      // Image preview functionality
      const courseImageInput = document.getElementById('courseImage');
      const imagePreview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');
      const existingImageUrl = document.getElementById('existingImageUrl');

      if (courseImageInput) {
        courseImageInput.addEventListener('change', function (e) {
          const file = e.target.files[0];
          if (file) {
            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
              alert('Image size must be less than 5MB');
              e.target.value = '';
              return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
              alert('Please select an image file');
              e.target.value = '';
              return;
            }

            // Show preview
            const reader = new FileReader();
            reader.onload = function (e) {
              previewImg.src = e.target.result;
              imagePreview.style.display = 'block';
              existingImageUrl.value = ''; // Clear existing URL when new file is selected
            };
            reader.readAsDataURL(file);
          } else {
            imagePreview.style.display = 'none';
          }
        });
      }

      // Auto-convert YouTube URLs to embed format
      const previewVideoInput = document.getElementById('previewVideoUrl');
      if (previewVideoInput) {
        previewVideoInput.addEventListener('blur', function () {
          let url = this.value.trim();
          if (url) {
            // Convert various YouTube URL formats to embed format
            // youtu.be/VIDEO_ID -> youtube.com/embed/VIDEO_ID
            // youtube.com/watch?v=VIDEO_ID -> youtube.com/embed/VIDEO_ID

            let videoId = null;

            // Check for youtu.be format
            if (url.includes('youtu.be/')) {
              videoId = url.split('youtu.be/')[1].split('?')[0].split('&')[0];
            }
            // Check for youtube.com/watch format
            else if (url.includes('youtube.com/watch')) {
              const urlParams = new URLSearchParams(url.split('?')[1]);
              videoId = urlParams.get('v');
            }
            // Check if already in embed format
            else if (url.includes('youtube.com/embed/')) {
              return; // Already in correct format
            }

            // Convert to embed format if we found a video ID
            if (videoId) {
              this.value = `https://www.youtube.com/embed/${videoId}`;
              // Show success message
              const helpText = this.nextElementSibling;
              if (helpText) {
                const originalText = helpText.innerHTML;
                helpText.innerHTML = '\u003cspan style="color: green;"\u003eâœ“ URL converted to embed format!\u003c/span\u003e';
                setTimeout(() => {
                  helpText.innerHTML = originalText;
                }, 3000);
              }
            }
          }
        });
      }

      // Setup course form
      const form = document.getElementById('addCourseForm');
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const editCourseId = document.getElementById('editCourseId').value;
          const courseTitle = document.getElementById('courseTitle').value;
          const courseDescription = document.getElementById('courseDescription').value;
          const courseImage = document.getElementById('courseImage');
          const coursePrice = document.getElementById('coursePrice').value;
          const courseCategory = document.getElementById('courseCategory').value;
          const previewVideoUrl = document.getElementById('previewVideoUrl').value;
          const courseSkills = document.getElementById('courseSkills').value;
          const message = document.getElementById('messageCourse');
          const isPublished = document.getElementById('isPublished').value;
          const durationHours = document.getElementById('durationHours').value;
          const existingUrl = existingImageUrl.value;

          message.textContent = '';
          message.style.display = 'none';

          // Validation
          if (!courseTitle || !courseDescription || !coursePrice || !durationHours || !courseCategory) {
            message.textContent = 'Please fill in all the fields.';
            message.style.display = 'block';
            message.style.color = 'red';
            return;
          }

          // Check if image is required (for new courses) or if new image is uploaded (for updates)
          if (!editCourseId && !courseImage.files[0]) {
            message.textContent = 'Please upload a course image.';
            message.style.display = 'block';
            message.style.color = 'red';
            return;
          }

          // If editing and no new image, use existing URL
          if (editCourseId && !courseImage.files[0] && !existingUrl) {
            message.textContent = 'Please upload a course image or keep the existing one.';
            message.style.display = 'block';
            message.style.color = 'red';
            return;
          }

          const url = editCourseId ? `/admin/updateCourse/${editCourseId}` : '/admin/addCourse';
          const method = editCourseId ? 'PUT' : 'POST';

          // Create FormData for file upload
          const formData = new FormData();
          formData.append('title', courseTitle);
          formData.append('description', courseDescription);
          formData.append('price', coursePrice);
          formData.append('level', courseCategory);
          formData.append('previewVideoUrl', previewVideoUrl);
          formData.append('skills', courseSkills);
          formData.append('isPublished', isPublished);
          formData.append('durationHours', durationHours);

          if (courseImage.files[0]) {
            formData.append('courseImage', courseImage.files[0]);
          }

          if (editCourseId && existingUrl) {
            formData.append('existingImageUrl', existingUrl);
          }

          try {
            const response = await fetch(url, {
              method: method,
              body: formData
            });
            const result = await response.json();

            if (result.success) {
              message.textContent = result.message;
              message.style.display = 'block';
              message.style.color = 'green';
              setTimeout(() => location.reload(), 1000);
            } else {
              message.textContent = result.message || 'Failed to save course.';
              message.style.display = 'block';
              message.style.color = 'red';
            }
          } catch (error) {
            console.error('Error:', error);
            message.textContent = 'Error connecting to the server.';
            message.style.display = 'block';
            message.style.color = 'red';
          }
        });
      }
    });

    // ======== Quiz Management Functions ========

    // Load quizzes data
    function loadQuizzes() {
      fetch('/admin/api/quizzes')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            displayQuizzes(data.quizzes);
            loadLanguageFilter(data.quizzes);
          }
        })
        .catch(error => console.error('Error loading quizzes:', error));
    }

    // Display quizzes in table
    function displayQuizzes(quizzes) {
      const tbody = document.getElementById('quizzesTableBody');
      tbody.innerHTML = '';

      quizzes.forEach(quiz => {
        const row = `
          <tr>
            <td>${quiz.id}</td>
            <td><span class="badge bg-primary">${quiz.language}</span></td>
            <td style="max-width: 300px;">${quiz.question.substring(0, 100)}${quiz.question.length > 100 ? '...' : ''}</td>
            <td><strong>${quiz.correct_option}</strong></td>
            <td>
              <button class="btn btn-sm btn-info" onclick="editQuiz(${quiz.id})" title="Edit Question">
                <span class="material-symbols-outlined">edit</span>
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteQuiz(${quiz.id})" title="Delete Question">
                <span class="material-symbols-outlined">delete</span>
              </button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    // Load language filter options
    function loadLanguageFilter(quizzes) {
      const filter = document.getElementById('languageFilter');
      const languages = [...new Set(quizzes.map(q => q.language))];

      // Clear existing options except "All Languages"
      filter.innerHTML = '<option value="">All Languages</option>';

      languages.forEach(lang => {
        filter.innerHTML += `<option value="${lang}">${lang}</option>`;
      });
    }

    // Filter quizzes by language
    function filterQuizzesByLanguage() {
      const selectedLanguage = document.getElementById('languageFilter').value;
      const url = selectedLanguage ? `/admin/api/quizzes?language=${selectedLanguage}` : '/admin/api/quizzes';

      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            displayQuizzes(data.quizzes);
          }
        })
        .catch(error => console.error('Error filtering quizzes:', error));
    }

    // Open add quiz modal
    function openAddQuizModal() {
      document.getElementById('addQuizModalLabel').textContent = 'Add Quiz Question';
      document.getElementById('addQuizForm').reset();
      document.getElementById('editQuizId').value = '';
      document.getElementById('messageQuiz').style.display = 'none';

      const modal = new bootstrap.Modal(document.getElementById('addQuizModal'));
      modal.show();
    }

    // Edit quiz (populate modal with existing data)
    function editQuiz(quizId) {
      document.getElementById('addQuizModalLabel').textContent = 'Edit Quiz Question';
      document.getElementById('editQuizId').value = quizId;

      const modal = new bootstrap.Modal(document.getElementById('addQuizModal'));
      modal.show();
    }

    // Delete quiz
    function deleteQuiz(quizId) {
      if (confirm('Are you sure you want to delete this quiz question?')) {
        fetch(`/admin/api/quizzes/${quizId}`, {
          method: 'DELETE'
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Question deleted successfully!');
              loadQuizzes(); // Reload the table
            } else {
              alert('Error: ' + data.message);
            }
          })
          .catch(error => {
            console.error('Error deleting quiz:', error);
            alert('Error deleting question');
          });
      }
    }

    // Setup quiz form submission
    document.addEventListener('DOMContentLoaded', function () {
      const quizForm = document.getElementById('addQuizForm');
      if (quizForm) {
        quizForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          await saveQuizQuestion(false);
        });

        // Save & Add Another button
        const saveAndAddBtn = document.getElementById('saveAndAddAnother');
        if (saveAndAddBtn) {
          saveAndAddBtn.addEventListener('click', async () => {
            await saveQuizQuestion(true);
          });
        }
      }

      // Bulk import file handling
      const bulkFileInput = document.getElementById('bulkQuizFile');
      if (bulkFileInput) {
        bulkFileInput.addEventListener('change', handleBulkFileUpload);
      }

      // Import button
      const importBtn = document.getElementById('importBulkQuizzes');
      if (importBtn) {
        importBtn.addEventListener('click', importBulkQuizzes);
      }
    });

    // Download quiz template
    function downloadQuizTemplate() {
      const template = [
        {
          "language": "JavaScript",
          "question": "What is the output of: console.log(typeof [])?",
          "option_a": "array",
          "option_b": "object",
          "option_c": "undefined",
          "option_d": "null",
          "correct_option": "B"
        },
        {
          "language": "Python",
          "question": "Which keyword is used to define a function in Python?",
          "option_a": "function",
          "option_b": "def",
          "option_c": "func",
          "option_d": "define",
          "correct_option": "B"
        }
      ];

      const jsonStr = JSON.stringify(template, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'quiz_template.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Save quiz question function
    async function saveQuizQuestion(addAnother = false) {
      const editQuizId = document.getElementById('editQuizId').value;
      const programmingLanguage = document.getElementById('programmingLanguage').value;
      const quizQuestion = document.getElementById('quizQuestion').value;
      const optionA = document.getElementById('optionA').value;
      const optionB = document.getElementById('optionB').value;
      const optionC = document.getElementById('optionC').value;
      const optionD = document.getElementById('optionD').value;

      // Get the selected radio button value
      const correctOptionInputs = document.querySelectorAll('input[name="correctOption"]');
      let correctOption = '';
      for (const input of correctOptionInputs) {
        if (input.checked) {
          correctOption = input.value;
          break;
        }
      }

      const message = document.getElementById('messageQuiz');

      message.textContent = '';
      message.style.display = 'none';

      // Validation
      if (!programmingLanguage || !quizQuestion || !optionA || !optionB || !optionC || !optionD || !correctOption) {
        message.textContent = 'Please fill in all fields and select the correct answer.';
        message.style.display = 'block';
        message.style.color = 'red';
        return;
      }

      const quizData = {
        language: programmingLanguage,
        question: quizQuestion,
        option_a: optionA,
        option_b: optionB,
        option_c: optionC,
        option_d: optionD,
        correct_option: correctOption
      };

      try {
        const response = await fetch('/admin/api/quizzes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(quizData)
        });

        const result = await response.json();

        if (result.success) {
          message.textContent = result.message;
          message.style.display = 'block';
          message.style.color = 'green';

          if (addAnother) {
            // Reset form but keep it open
            setTimeout(() => {
              document.getElementById('addQuizForm').reset();
              // Uncheck all radio buttons
              correctOptionInputs.forEach(input => input.checked = false);
              message.style.display = 'none';
              loadQuizzes(); // Reload the table
            }, 1000);
          } else {
            setTimeout(() => {
              const modal = bootstrap.Modal.getInstance(document.getElementById('addQuizModal'));
              modal.hide();
              loadQuizzes(); // Reload the table
            }, 1000);
          }
        } else {
          message.textContent = result.message || 'Failed to save question.';
          message.style.display = 'block';
          message.style.color = 'red';
        }
      } catch (error) {
        console.error('Error:', error);
        message.textContent = 'Error connecting to the server.';
        message.style.display = 'block';
        message.style.color = 'red';
      }
    }

    // Handle bulk file upload
    let bulkQuizData = null;

    function handleBulkFileUpload(event) {
      const file = event.target.files[0];
      const preview = document.getElementById('bulkPreview');
      const previewContent = document.getElementById('bulkPreviewContent');
      const importBtn = document.getElementById('importBulkQuizzes');
      const message = document.getElementById('messageBulk');

      if (!file) {
        preview.style.display = 'none';
        importBtn.disabled = true;
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const json = JSON.parse(e.target.result);

          if (!Array.isArray(json)) {
            throw new Error('JSON must be an array of quiz questions');
          }

          // Validate each question
          for (let i = 0; i < json.length; i++) {
            const q = json[i];
            if (!q.language || !q.question || !q.option_a || !q.option_b || !q.option_c || !q.option_d || !q.correct_option) {
              throw new Error(`Question ${i + 1} is missing required fields`);
            }
          }

          bulkQuizData = json;

          // Show preview
          previewContent.innerHTML = `
            <p><strong>Found ${json.length} question(s)</strong></p>
            <ul style="margin-bottom: 0;">
              ${json.slice(0, 3).map((q, i) => `<li><strong>${q.language}:</strong> ${q.question.substring(0, 60)}...</li>`).join('')}
              ${json.length > 3 ? `<li><em>... and ${json.length - 3} more question(s)</em></li>` : ''}
            </ul>
          `;
          preview.style.display = 'block';
          importBtn.disabled = false;
          message.style.display = 'none';

        } catch (error) {
          message.textContent = 'Invalid JSON file: ' + error.message;
          message.style.display = 'block';
          message.style.color = 'red';
          preview.style.display = 'none';
          importBtn.disabled = true;
          bulkQuizData = null;
        }
      };

      reader.readAsText(file);
    }

    // Import bulk quizzes
    async function importBulkQuizzes() {
      if (!bulkQuizData) return;

      const message = document.getElementById('messageBulk');
      const importBtn = document.getElementById('importBulkQuizzes');

      importBtn.disabled = true;
      message.textContent = 'Importing questions...';
      message.style.display = 'block';
      message.style.color = 'blue';

      try {
        const response = await fetch('/admin/api/quizzes/bulk', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ quizzes: bulkQuizData })
        });

        const result = await response.json();

        if (result.success) {
          message.textContent = `Successfully imported ${bulkQuizData.length} question(s)!`;
          message.style.color = 'green';

          setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('addQuizModal'));
            modal.hide();
            loadQuizzes(); // Reload the table

            // Reset
            document.getElementById('bulkQuizFile').value = '';
            document.getElementById('bulkPreview').style.display = 'none';
            message.style.display = 'none';
            bulkQuizData = null;
          }, 1500);
        } else {
          message.textContent = result.message || 'Failed to import questions.';
          message.style.color = 'red';
          importBtn.disabled = false;
        }
      } catch (error) {
        console.error('Error:', error);
        message.textContent = 'Error connecting to the server.';
        message.style.color = 'red';
        importBtn.disabled = false;
      }
    }
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>

</body>

</html>